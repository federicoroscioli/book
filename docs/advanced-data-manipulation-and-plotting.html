<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>4 Advanced Data Manipulation and Plotting | Introduction to Data Analysis with R</title>
  <meta name="description" content="4 Advanced Data Manipulation and Plotting | Introduction to Data Analysis with R" />
  <meta name="generator" content="bookdown 0.35 and GitBook 2.6.7" />

  <meta property="og:title" content="4 Advanced Data Manipulation and Plotting | Introduction to Data Analysis with R" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4 Advanced Data Manipulation and Plotting | Introduction to Data Analysis with R" />
  
  
  

<meta name="author" content="Federico Roscioli" />


<meta name="date" content="2023-10-17" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="data-cleaning.html"/>
<link rel="next" href="exploratory-data-analysis.html"/>
<script src="book_assets/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="book_assets/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="book_assets/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="book_assets/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="book_assets/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="book_assets/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="book_assets/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="book_assets/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="book_assets/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="book_assets/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="book_assets/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="preface.html"><a href="preface.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="part"><span><b>I Section 1 - The R code</b></span></li>
<li class="chapter" data-level="1" data-path="installation.html"><a href="installation.html"><i class="fa fa-check"></i><b>1</b> Installation</a>
<ul>
<li class="chapter" data-level="1.1" data-path="installation.html"><a href="installation.html#introductory-activities"><i class="fa fa-check"></i><b>1.1</b> Introductory activities</a></li>
<li class="chapter" data-level="1.2" data-path="installation.html"><a href="installation.html#visualization-suggestions"><i class="fa fa-check"></i><b>1.2</b> Visualization suggestions</a></li>
<li class="chapter" data-level="1.3" data-path="installation.html"><a href="installation.html#the-workspace"><i class="fa fa-check"></i><b>1.3</b> The workspace</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="a-b-c.html"><a href="a-b-c.html"><i class="fa fa-check"></i><b>2</b> A, B, C</a>
<ul>
<li class="chapter" data-level="2.1" data-path="a-b-c.html"><a href="a-b-c.html#the-first-code"><i class="fa fa-check"></i><b>2.1</b> The first code</a></li>
<li class="chapter" data-level="2.2" data-path="a-b-c.html"><a href="a-b-c.html#indexing"><i class="fa fa-check"></i><b>2.2</b> Indexing</a></li>
<li class="chapter" data-level="2.3" data-path="a-b-c.html"><a href="a-b-c.html#the-first-function"><i class="fa fa-check"></i><b>2.3</b> The first function</a></li>
<li class="chapter" data-level="2.4" data-path="a-b-c.html"><a href="a-b-c.html#dataset-exploration"><i class="fa fa-check"></i><b>2.4</b> Dataset Exploration</a></li>
<li class="chapter" data-level="2.5" data-path="a-b-c.html"><a href="a-b-c.html#subsetting"><i class="fa fa-check"></i><b>2.5</b> Subsetting</a></li>
<li class="chapter" data-level="2.6" data-path="a-b-c.html"><a href="a-b-c.html#importing-and-exporting-data"><i class="fa fa-check"></i><b>2.6</b> Importing and exporting data</a></li>
<li class="chapter" data-level="2.7" data-path="a-b-c.html"><a href="a-b-c.html#exercises"><i class="fa fa-check"></i><b>2.7</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="data-cleaning.html"><a href="data-cleaning.html"><i class="fa fa-check"></i><b>3</b> Data Cleaning</a>
<ul>
<li class="chapter" data-level="3.1" data-path="data-cleaning.html"><a href="data-cleaning.html#variable-names"><i class="fa fa-check"></i><b>3.1</b> Variable Names</a></li>
<li class="chapter" data-level="3.2" data-path="data-cleaning.html"><a href="data-cleaning.html#variable-types"><i class="fa fa-check"></i><b>3.2</b> Variable Types</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="data-cleaning.html"><a href="data-cleaning.html#factor-variables"><i class="fa fa-check"></i><b>3.2.1</b> Factor variables</a></li>
<li class="chapter" data-level="3.2.2" data-path="data-cleaning.html"><a href="data-cleaning.html#dates-and-times"><i class="fa fa-check"></i><b>3.2.2</b> Dates and times</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="data-cleaning.html"><a href="data-cleaning.html#row-names"><i class="fa fa-check"></i><b>3.3</b> Row Names</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="advanced-data-manipulation-and-plotting.html"><a href="advanced-data-manipulation-and-plotting.html"><i class="fa fa-check"></i><b>4</b> Advanced Data Manipulation and Plotting</a>
<ul>
<li class="chapter" data-level="4.1" data-path="advanced-data-manipulation-and-plotting.html"><a href="advanced-data-manipulation-and-plotting.html#ifelse"><i class="fa fa-check"></i><b>4.1</b> Ifelse</a></li>
<li class="chapter" data-level="4.2" data-path="advanced-data-manipulation-and-plotting.html"><a href="advanced-data-manipulation-and-plotting.html#the-apply-family"><i class="fa fa-check"></i><b>4.2</b> The Apply family</a></li>
<li class="chapter" data-level="4.3" data-path="advanced-data-manipulation-and-plotting.html"><a href="advanced-data-manipulation-and-plotting.html#dplyr"><i class="fa fa-check"></i><b>4.3</b> Dplyr</a></li>
<li class="chapter" data-level="4.4" data-path="advanced-data-manipulation-and-plotting.html"><a href="advanced-data-manipulation-and-plotting.html#merging-datasets"><i class="fa fa-check"></i><b>4.4</b> Merging datasets</a></li>
<li class="chapter" data-level="4.5" data-path="advanced-data-manipulation-and-plotting.html"><a href="advanced-data-manipulation-and-plotting.html#melting-vs-transposing"><i class="fa fa-check"></i><b>4.5</b> Melting vs Transposing</a></li>
<li class="chapter" data-level="4.6" data-path="advanced-data-manipulation-and-plotting.html"><a href="advanced-data-manipulation-and-plotting.html#ggplot2"><i class="fa fa-check"></i><b>4.6</b> Ggplot2</a></li>
<li class="chapter" data-level="4.7" data-path="advanced-data-manipulation-and-plotting.html"><a href="advanced-data-manipulation-and-plotting.html#exercises-1"><i class="fa fa-check"></i><b>4.7</b> Exercises</a></li>
</ul></li>
<li class="part"><span><b>II Section 2 - Statistical Analysis</b></span></li>
<li class="chapter" data-level="5" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html"><i class="fa fa-check"></i><b>5</b> Exploratory Data Analysis</a>
<ul>
<li class="chapter" data-level="5.1" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#central-tendency-measures"><i class="fa fa-check"></i><b>5.1</b> Central Tendency Measures</a></li>
<li class="chapter" data-level="5.2" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#variability-measures"><i class="fa fa-check"></i><b>5.2</b> Variability Measures</a></li>
<li class="chapter" data-level="5.3" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#inequality-measures"><i class="fa fa-check"></i><b>5.3</b> Inequality Measures</a></li>
<li class="chapter" data-level="5.4" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#data-visualization"><i class="fa fa-check"></i><b>5.4</b> Data visualization</a></li>
<li class="chapter" data-level="5.5" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#scaling-data"><i class="fa fa-check"></i><b>5.5</b> Scaling data</a></li>
<li class="chapter" data-level="5.6" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#probability-sampling"><i class="fa fa-check"></i><b>5.6</b> Probability Sampling</a></li>
<li class="chapter" data-level="5.7" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#exercises-2"><i class="fa fa-check"></i><b>5.7</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="hypothesis-testing.html"><a href="hypothesis-testing.html"><i class="fa fa-check"></i><b>6</b> Hypothesis Testing</a>
<ul>
<li class="chapter" data-level="6.1" data-path="hypothesis-testing.html"><a href="hypothesis-testing.html#probability-distributions"><i class="fa fa-check"></i><b>6.1</b> Probability Distributions</a></li>
<li class="chapter" data-level="6.2" data-path="hypothesis-testing.html"><a href="hypothesis-testing.html#shapiro-wilk-test"><i class="fa fa-check"></i><b>6.2</b> Shapiro-Wilk Test</a></li>
<li class="chapter" data-level="6.3" data-path="hypothesis-testing.html"><a href="hypothesis-testing.html#one-sample-t-test"><i class="fa fa-check"></i><b>6.3</b> One-Sample T-Test</a></li>
<li class="chapter" data-level="6.4" data-path="hypothesis-testing.html"><a href="hypothesis-testing.html#unpaired-two-sample-t-test"><i class="fa fa-check"></i><b>6.4</b> Unpaired Two Sample T-Test</a></li>
<li class="chapter" data-level="6.5" data-path="hypothesis-testing.html"><a href="hypothesis-testing.html#mann-whitney-u-test"><i class="fa fa-check"></i><b>6.5</b> Mann Whitney U Test</a></li>
<li class="chapter" data-level="6.6" data-path="hypothesis-testing.html"><a href="hypothesis-testing.html#paired-sample-t-test"><i class="fa fa-check"></i><b>6.6</b> Paired Sample T-Test</a></li>
<li class="chapter" data-level="6.7" data-path="hypothesis-testing.html"><a href="hypothesis-testing.html#exercises-3"><i class="fa fa-check"></i><b>6.7</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="bivariate-analysis.html"><a href="bivariate-analysis.html"><i class="fa fa-check"></i><b>7</b> Bivariate Analysis</a>
<ul>
<li class="chapter" data-level="7.1" data-path="bivariate-analysis.html"><a href="bivariate-analysis.html#correlation"><i class="fa fa-check"></i><b>7.1</b> Correlation</a></li>
<li class="chapter" data-level="7.2" data-path="bivariate-analysis.html"><a href="bivariate-analysis.html#linear-regression"><i class="fa fa-check"></i><b>7.2</b> Linear Regression</a></li>
<li class="chapter" data-level="7.3" data-path="bivariate-analysis.html"><a href="bivariate-analysis.html#logistic-regressions"><i class="fa fa-check"></i><b>7.3</b> Logistic Regressions</a></li>
<li class="chapter" data-level="7.4" data-path="bivariate-analysis.html"><a href="bivariate-analysis.html#exercises-4"><i class="fa fa-check"></i><b>7.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="multivariate-analysis.html"><a href="multivariate-analysis.html"><i class="fa fa-check"></i><b>8</b> Multivariate Analysis</a>
<ul>
<li class="chapter" data-level="8.1" data-path="multivariate-analysis.html"><a href="multivariate-analysis.html#cluster-analysis"><i class="fa fa-check"></i><b>8.1</b> Cluster Analysis</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="multivariate-analysis.html"><a href="multivariate-analysis.html#hierarchical-clustering"><i class="fa fa-check"></i><b>8.1.1</b> Hierarchical Clustering</a></li>
<li class="chapter" data-level="8.1.2" data-path="multivariate-analysis.html"><a href="multivariate-analysis.html#k-means-clustering"><i class="fa fa-check"></i><b>8.1.2</b> K-Means clustering</a></li>
<li class="chapter" data-level="8.1.3" data-path="multivariate-analysis.html"><a href="multivariate-analysis.html#the-silhouette-plot"><i class="fa fa-check"></i><b>8.1.3</b> The silhouette plot</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="multivariate-analysis.html"><a href="multivariate-analysis.html#heatmap"><i class="fa fa-check"></i><b>8.2</b> Heatmap</a></li>
<li class="chapter" data-level="8.3" data-path="multivariate-analysis.html"><a href="multivariate-analysis.html#principal-component-analysis"><i class="fa fa-check"></i><b>8.3</b> Principal Component Analysis</a></li>
<li class="chapter" data-level="8.4" data-path="multivariate-analysis.html"><a href="multivariate-analysis.html#classification-and-regression-trees"><i class="fa fa-check"></i><b>8.4</b> Classification And Regression Trees</a></li>
<li class="chapter" data-level="8.5" data-path="multivariate-analysis.html"><a href="multivariate-analysis.html#composite-indicators"><i class="fa fa-check"></i><b>8.5</b> Composite Indicators</a>
<ul>
<li class="chapter" data-level="8.5.1" data-path="multivariate-analysis.html"><a href="multivariate-analysis.html#mazziotta-pareto-index"><i class="fa fa-check"></i><b>8.5.1</b> Mazziotta-Pareto Index</a></li>
<li class="chapter" data-level="8.5.2" data-path="multivariate-analysis.html"><a href="multivariate-analysis.html#adjusted-mazziotta-pareto-index"><i class="fa fa-check"></i><b>8.5.2</b> Adjusted Mazziotta-Pareto Index</a></li>
</ul></li>
<li class="chapter" data-level="8.6" data-path="multivariate-analysis.html"><a href="multivariate-analysis.html#exercises-5"><i class="fa fa-check"></i><b>8.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="final-remarks.html"><a href="final-remarks.html"><i class="fa fa-check"></i>Final Remarks</a></li>
<li class="chapter" data-level="" data-path="bibliography.html"><a href="bibliography.html"><i class="fa fa-check"></i>Bibliography</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Introduction to Data Analysis with R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">

<div id="advanced-data-manipulation-and-plotting" class="section level1 hasAnchor" number="4">
<h1><span class="header-section-number">4</span> Advanced Data Manipulation and Plotting<a href="advanced-data-manipulation-and-plotting.html#advanced-data-manipulation-and-plotting" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>It is time to become a pro! Well, becoming a “pro” in R doesn’t strictly
that we will have to do complex things, or become some crazy freaks not
leaving our laptop and squeaking like lab rats. Becoming a pro means
being able to do things in another way. Sometimes an easier way, other
times a more complex way that allows us to reach a higher level of
output.</p>
<p>Now you will be asking: “If there are easier ways, why did we learn the
complex part at the beginning?” Well, Michael Jordan would answer you:
“Get the fundamentals down and the level of everything you do will
rise.” So, basically, we need the grammar in order to write a sentence.</p>
<p>Now, put your “pro” hat on!</p>
<p> </p>
<p> </p>
<p> </p>
<div id="ifelse" class="section level2 hasAnchor" number="4.1">
<h2><span class="header-section-number">4.1</span> Ifelse<a href="advanced-data-manipulation-and-plotting.html#ifelse" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The <code>ifelse()</code> function allows us to give R multiple inputs according to
one or more conditions. This function is used a lot when cleaning data
and when we want to create new variables.</p>
<p>As an example, we want to generate a variable equal to 1 if the car
consumes less than 20, and equal to 0 in all the other cases. Or we can
create the same variable with more than one condition. Or we want to
create a new variable with more than two levels. Finally, we may want to
correct some values according to our conditions.</p>
<p>Within the <code>ifelse()</code> function we are required to specify the
condition(s), comma, the value to give if the condition(s) is true,
comma, the value to give if the condition(s) is false.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="advanced-data-manipulation-and-plotting.html#cb18-1" tabindex="-1"></a><span class="co"># creating a new var conditionally</span></span>
<span id="cb18-2"><a href="advanced-data-manipulation-and-plotting.html#cb18-2" tabindex="-1"></a>mtcars<span class="sc">$</span>newvar <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(mtcars<span class="sc">$</span>mpg <span class="sc">&lt;</span> <span class="dv">20</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb18-3"><a href="advanced-data-manipulation-and-plotting.html#cb18-3" tabindex="-1"></a></span>
<span id="cb18-4"><a href="advanced-data-manipulation-and-plotting.html#cb18-4" tabindex="-1"></a><span class="co"># creating a new var with more conditions</span></span>
<span id="cb18-5"><a href="advanced-data-manipulation-and-plotting.html#cb18-5" tabindex="-1"></a>mtcars<span class="sc">$</span>newvar <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(mtcars<span class="sc">$</span>mpg <span class="sc">&gt;</span> <span class="dv">20</span> <span class="sc">&amp;</span> mtcars<span class="sc">$</span>cyl <span class="sc">&lt;</span> <span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb18-6"><a href="advanced-data-manipulation-and-plotting.html#cb18-6" tabindex="-1"></a></span>
<span id="cb18-7"><a href="advanced-data-manipulation-and-plotting.html#cb18-7" tabindex="-1"></a><span class="co"># creating a new var with more and more conditions in nested way</span></span>
<span id="cb18-8"><a href="advanced-data-manipulation-and-plotting.html#cb18-8" tabindex="-1"></a>mtcars<span class="sc">$</span>newvar <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(mtcars<span class="sc">$</span>mpg <span class="sc">&gt;</span> <span class="dv">20</span>, <span class="dv">100</span>,</span>
<span id="cb18-9"><a href="advanced-data-manipulation-and-plotting.html#cb18-9" tabindex="-1"></a>                        <span class="fu">ifelse</span>(mtcars<span class="sc">$</span>mpg <span class="sc">&lt;</span> <span class="dv">17</span>, <span class="dv">10</span> ,</span>
<span id="cb18-10"><a href="advanced-data-manipulation-and-plotting.html#cb18-10" tabindex="-1"></a>                                <span class="fu">ifelse</span>(mtcars<span class="sc">$</span>cyl <span class="sc">==</span> <span class="dv">6</span>, <span class="cn">NA</span> , mtcars<span class="sc">$</span>mpg )))</span>
<span id="cb18-11"><a href="advanced-data-manipulation-and-plotting.html#cb18-11" tabindex="-1"></a><span class="co"># correctin a variable</span></span>
<span id="cb18-12"><a href="advanced-data-manipulation-and-plotting.html#cb18-12" tabindex="-1"></a>mtcars<span class="sc">$</span>mpg <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(mtcars<span class="sc">$</span>cyl<span class="sc">&gt;</span><span class="dv">5</span>, <span class="cn">NA</span>, mtcars<span class="sc">$</span>mpg)</span>
<span id="cb18-13"><a href="advanced-data-manipulation-and-plotting.html#cb18-13" tabindex="-1"></a><span class="co">#this is the same as</span></span>
<span id="cb18-14"><a href="advanced-data-manipulation-and-plotting.html#cb18-14" tabindex="-1"></a>mtcars<span class="sc">$</span>mpg[mtcars<span class="sc">$</span>cyl<span class="sc">&gt;</span><span class="dv">5</span>] <span class="ot">&lt;-</span> <span class="cn">NA</span></span></code></pre></div>
<p>In the case in which we have a categorical variable with multiple
categories (i.e. the color of the car), and/or we want to create dummies
for multiple categorical variables at once (i.e. the variables: red,
green, blue, etc), I suggest to use the package
<code>fastDummies</code><span class="citation">(<a href="#ref-kaplan2022">Kaplan 2022</a>)</span>. Note that in the argument <code>select_columns</code>
you can specify multiple columns using <code>c()</code>. The argument
<code>remove_selected_columns</code> removes the original categorical variable
after the transformation.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="advanced-data-manipulation-and-plotting.html#cb19-1" tabindex="-1"></a><span class="fu">library</span>(fastDummies)</span>
<span id="cb19-2"><a href="advanced-data-manipulation-and-plotting.html#cb19-2" tabindex="-1"></a><span class="fu">dummy_cols</span>(mtcars, <span class="at">select_columns =</span> <span class="st">&quot;cyl&quot;</span>, <span class="at">remove_selected_columns =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p> </p>
<p> </p>
<p> </p>
</div>
<div id="the-apply-family" class="section level2 hasAnchor" number="4.2">
<h2><span class="header-section-number">4.2</span> The Apply family<a href="advanced-data-manipulation-and-plotting.html#the-apply-family" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The <code>apply()</code> function is a great facilitator. it applies a function of
our choice to the whole dataset by row, or by column
<span class="citation">(<a href="#ref-sovanskywinter2022">Sovansky Winter 2022</a>)</span>. This means that, using this function, we can
compute the mean (or a more complex calculus) on all the variables of
the data! So we can create our own summary of the data.</p>
<p>Within the <code>apply()</code> function we have to impute the data we want to
manipulate, comma, if we want it to apply the function row-wise (1) or
column-wise (2), comma, the function we want to apply to the data.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="advanced-data-manipulation-and-plotting.html#cb20-1" tabindex="-1"></a><span class="do">############## apply</span></span>
<span id="cb20-2"><a href="advanced-data-manipulation-and-plotting.html#cb20-2" tabindex="-1"></a><span class="co"># calculate the mean per each column</span></span>
<span id="cb20-3"><a href="advanced-data-manipulation-and-plotting.html#cb20-3" tabindex="-1"></a><span class="fu">apply</span>(mtcars, <span class="dv">2</span>, mean)</span>
<span id="cb20-4"><a href="advanced-data-manipulation-and-plotting.html#cb20-4" tabindex="-1"></a></span>
<span id="cb20-5"><a href="advanced-data-manipulation-and-plotting.html#cb20-5" tabindex="-1"></a><span class="co"># filter out rows where the mean of the row is lower than 20</span></span>
<span id="cb20-6"><a href="advanced-data-manipulation-and-plotting.html#cb20-6" tabindex="-1"></a>mtcars[<span class="sc">-</span><span class="fu">apply</span>(mtcars, <span class="dv">1</span>, mean) <span class="sc">&lt;</span> <span class="dv">20</span>,]</span>
<span id="cb20-7"><a href="advanced-data-manipulation-and-plotting.html#cb20-7" tabindex="-1"></a></span>
<span id="cb20-8"><a href="advanced-data-manipulation-and-plotting.html#cb20-8" tabindex="-1"></a><span class="co"># create statistical summary</span></span>
<span id="cb20-9"><a href="advanced-data-manipulation-and-plotting.html#cb20-9" tabindex="-1"></a>Stat<span class="ot">&lt;-</span><span class="fu">cbind</span>(</span>
<span id="cb20-10"><a href="advanced-data-manipulation-and-plotting.html#cb20-10" tabindex="-1"></a>  <span class="fu">apply</span>(mtcars[,<span class="fu">c</span>(<span class="st">&quot;mpg&quot;</span>, <span class="st">&quot;cyl&quot;</span>, <span class="st">&quot;disp&quot;</span>, <span class="st">&quot;hp&quot;</span>,<span class="st">&quot;drat&quot;</span>)],<span class="dv">2</span>,mean), </span>
<span id="cb20-11"><a href="advanced-data-manipulation-and-plotting.html#cb20-11" tabindex="-1"></a>  <span class="fu">apply</span>(mtcars[,<span class="fu">c</span>(<span class="st">&quot;mpg&quot;</span>, <span class="st">&quot;cyl&quot;</span>, <span class="st">&quot;disp&quot;</span>, <span class="st">&quot;hp&quot;</span>,<span class="st">&quot;drat&quot;</span>)],<span class="dv">2</span>,sd),</span>
<span id="cb20-12"><a href="advanced-data-manipulation-and-plotting.html#cb20-12" tabindex="-1"></a>  <span class="fu">apply</span>(mtcars[mtcars<span class="sc">$</span>am<span class="sc">==</span><span class="dv">0</span>,<span class="fu">c</span>(<span class="st">&quot;mpg&quot;</span>, <span class="st">&quot;cyl&quot;</span>, <span class="st">&quot;disp&quot;</span>, <span class="st">&quot;hp&quot;</span>,<span class="st">&quot;drat&quot;</span>)],<span class="dv">2</span>,mean),</span>
<span id="cb20-13"><a href="advanced-data-manipulation-and-plotting.html#cb20-13" tabindex="-1"></a>  <span class="fu">apply</span>(mtcars[mtcars<span class="sc">$</span>am<span class="sc">==</span><span class="dv">1</span>,<span class="fu">c</span>(<span class="st">&quot;mpg&quot;</span>, <span class="st">&quot;cyl&quot;</span>, <span class="st">&quot;disp&quot;</span>, <span class="st">&quot;hp&quot;</span>,<span class="st">&quot;drat&quot;</span>)],<span class="dv">2</span>,mean)</span>
<span id="cb20-14"><a href="advanced-data-manipulation-and-plotting.html#cb20-14" tabindex="-1"></a>)</span>
<span id="cb20-15"><a href="advanced-data-manipulation-and-plotting.html#cb20-15" tabindex="-1"></a><span class="fu">colnames</span>(Stat)<span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Mean&quot;</span>, <span class="st">&quot;s.d.&quot;</span>, <span class="st">&quot;Mean Automatic&quot;</span>, <span class="st">&quot;Mean Manual&quot;</span>)</span>
<span id="cb20-16"><a href="advanced-data-manipulation-and-plotting.html#cb20-16" tabindex="-1"></a><span class="fu">round</span>(Stat,<span class="dv">2</span>)</span></code></pre></div>
<p> </p>
<p> </p>
<p> </p>
</div>
<div id="dplyr" class="section level2 hasAnchor" number="4.3">
<h2><span class="header-section-number">4.3</span> Dplyr<a href="advanced-data-manipulation-and-plotting.html#dplyr" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Following on powerful things, we have the <code>dplyr</code> package
<span class="citation">(<a href="#ref-wickham2022">Wickham and Bryan 2022</a>)</span>. Well, this is one of my favorite packages in R. In fact,
<code>dplyr</code> allows us to do almost all that we have seen until now in an
easier and, sometimes, more intuitive way.</p>
<p><code>Dplyr</code> is a grammar of data manipulation, providing a consistent set of
verbs that help us solve the most common data manipulation challenges.
Basically, <code>dplyr</code> allows us to execute multiple functions a cascade. By
using the symbol <code>%&gt;%</code> at the end of each line, we tell R that the code
continues with another function (in fact R gives us an indent in the
following line)<span class="citation">(<a href="#ref-wickham2022">Wickham and Bryan 2022</a>)</span>.</p>
<p>The code below allows us to see at glance the big potential of this
package. First we filter the Star Wars characters by skin color;
secondly we compute the Body Mass Index (bmi) of all the characters, and
select only some columns from the original data; finally for each
species, we compute the number of characters and their average mass, and
we filter only the groups with more than one character and an average
mass above 50.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="advanced-data-manipulation-and-plotting.html#cb21-1" tabindex="-1"></a><span class="co"># loading the package and data</span></span>
<span id="cb21-2"><a href="advanced-data-manipulation-and-plotting.html#cb21-2" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb21-3"><a href="advanced-data-manipulation-and-plotting.html#cb21-3" tabindex="-1"></a><span class="fu">data</span>(starwars)</span>
<span id="cb21-4"><a href="advanced-data-manipulation-and-plotting.html#cb21-4" tabindex="-1"></a></span>
<span id="cb21-5"><a href="advanced-data-manipulation-and-plotting.html#cb21-5" tabindex="-1"></a><span class="co"># subsetting by skin color</span></span>
<span id="cb21-6"><a href="advanced-data-manipulation-and-plotting.html#cb21-6" tabindex="-1"></a>starwars <span class="sc">%&gt;%</span></span>
<span id="cb21-7"><a href="advanced-data-manipulation-and-plotting.html#cb21-7" tabindex="-1"></a>        <span class="fu">filter</span>(skin_color<span class="sc">==</span><span class="st">&quot;light&quot;</span>)</span>
<span id="cb21-8"><a href="advanced-data-manipulation-and-plotting.html#cb21-8" tabindex="-1"></a></span>
<span id="cb21-9"><a href="advanced-data-manipulation-and-plotting.html#cb21-9" tabindex="-1"></a><span class="co"># creating a new variable and subsetting some columns</span></span>
<span id="cb21-10"><a href="advanced-data-manipulation-and-plotting.html#cb21-10" tabindex="-1"></a>starwars <span class="sc">%&gt;%</span></span>
<span id="cb21-11"><a href="advanced-data-manipulation-and-plotting.html#cb21-11" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">bmi =</span> mass<span class="sc">/</span>((height<span class="sc">/</span><span class="dv">100</span>)<span class="sc">^</span><span class="dv">2</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb21-12"><a href="advanced-data-manipulation-and-plotting.html#cb21-12" tabindex="-1"></a>        <span class="fu">select</span>(name<span class="sc">:</span>mass, bmi)</span>
<span id="cb21-13"><a href="advanced-data-manipulation-and-plotting.html#cb21-13" tabindex="-1"></a></span>
<span id="cb21-14"><a href="advanced-data-manipulation-and-plotting.html#cb21-14" tabindex="-1"></a><span class="co"># creating a new dataset, summarizing the data grouped by species and filtering</span></span>
<span id="cb21-15"><a href="advanced-data-manipulation-and-plotting.html#cb21-15" tabindex="-1"></a><span class="co"># the most interesting information</span></span>
<span id="cb21-16"><a href="advanced-data-manipulation-and-plotting.html#cb21-16" tabindex="-1"></a>prova <span class="ot">&lt;-</span> starwars <span class="sc">%&gt;%</span></span>
<span id="cb21-17"><a href="advanced-data-manipulation-and-plotting.html#cb21-17" tabindex="-1"></a>        <span class="fu">group_by</span>(species) <span class="sc">%&gt;%</span></span>
<span id="cb21-18"><a href="advanced-data-manipulation-and-plotting.html#cb21-18" tabindex="-1"></a>        <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>(), </span>
<span id="cb21-19"><a href="advanced-data-manipulation-and-plotting.html#cb21-19" tabindex="-1"></a>                  <span class="at">mass =</span> <span class="fu">mean</span>(mass, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb21-20"><a href="advanced-data-manipulation-and-plotting.html#cb21-20" tabindex="-1"></a>        <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">1</span>, </span>
<span id="cb21-21"><a href="advanced-data-manipulation-and-plotting.html#cb21-21" tabindex="-1"></a>               mass <span class="sc">&gt;</span> <span class="dv">50</span>)</span></code></pre></div>
<p>So, using <code>dplyr</code>, with one command, we can ask R to group the data by a
categorical variable (<code>group_by()</code>), subset the data according to our
conditions (<code>filter()</code>), select only few variables to be retrieved
(<code>select()</code>), manipulate the current variables or create some new ones
(<code>mutate()</code>), summarize the data (<code>summarize()</code>), etc… Of course, all
of the above can be alternatively done using the indexing system and
multiple functions, but I live to you the choice.</p>
<p> </p>
<p> </p>
<p> </p>
</div>
<div id="merging-datasets" class="section level2 hasAnchor" number="4.4">
<h2><span class="header-section-number">4.4</span> Merging datasets<a href="advanced-data-manipulation-and-plotting.html#merging-datasets" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In R we can load multiple dataset and data formats in the memory, and
use them together. However, sometimes we want to have data from
different sources within the same object. This entails merging datasets
together. We may want to outer join, left join, cross join. And more
often, we may not be sure about what we want! My suggestion is to first
clear our mind by reading the following options:</p>
<ul>
<li><p><strong>Outer join</strong> merges the two datasets by a specified variable and
keeps all the observations <code>(all = TRUE)</code>.</p></li>
<li><p><strong>Left outer</strong> merges all the observations of object <span class="math inline">\(y\)</span> on <span class="math inline">\(x\)</span> only
if they have a corresponding <span class="math inline">\(id\)</span> variable (corresponding means that
the variable has the same name and type).</p></li>
<li><p><strong>Right outer</strong> merges all the observations of <span class="math inline">\(x\)</span> on <span class="math inline">\(y\)</span> only if
they have a corresponding <span class="math inline">\(id\)</span> variable (corresponding means that
the variable has the same name and type).</p></li>
<li><p><strong>Cross</strong> or cartesian product is one kind of join where each row of
one dataset is joined with other. So if we have a dataset of size
<span class="math inline">\(m\)</span> and if we join with other dataset with of size <span class="math inline">\(n\)</span>, we will get
a dataset with <span class="math inline">\(m*n\)</span> number of rows.</p></li>
</ul>
<p>Within the <code>merge()</code> function we are asked to specify the dataset <span class="math inline">\(x\)</span>,
comma the dataset $y$, comma, the name of the <span class="math inline">\(id\)</span> variable, comma,
additional arguments depending on which merge we are interested in.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="advanced-data-manipulation-and-plotting.html#cb22-1" tabindex="-1"></a><span class="co">#Outer join: </span></span>
<span id="cb22-2"><a href="advanced-data-manipulation-and-plotting.html#cb22-2" tabindex="-1"></a><span class="fu">merge</span>(<span class="at">x =</span> df1, <span class="at">y =</span> df2, <span class="at">by =</span> <span class="st">&quot;CustomerId&quot;</span>, <span class="at">all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb22-3"><a href="advanced-data-manipulation-and-plotting.html#cb22-3" tabindex="-1"></a></span>
<span id="cb22-4"><a href="advanced-data-manipulation-and-plotting.html#cb22-4" tabindex="-1"></a><span class="co">#Left outer: </span></span>
<span id="cb22-5"><a href="advanced-data-manipulation-and-plotting.html#cb22-5" tabindex="-1"></a><span class="fu">merge</span>(<span class="at">x =</span> df1, <span class="at">y =</span> df2, <span class="at">by =</span> <span class="st">&quot;CustomerId&quot;</span>, <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb22-6"><a href="advanced-data-manipulation-and-plotting.html#cb22-6" tabindex="-1"></a></span>
<span id="cb22-7"><a href="advanced-data-manipulation-and-plotting.html#cb22-7" tabindex="-1"></a><span class="co">#Right outer: </span></span>
<span id="cb22-8"><a href="advanced-data-manipulation-and-plotting.html#cb22-8" tabindex="-1"></a><span class="fu">merge</span>(<span class="at">x =</span> df1, <span class="at">y =</span> df2, <span class="at">by =</span> <span class="st">&quot;CustomerId&quot;</span>, <span class="at">all.y =</span> <span class="cn">TRUE</span>)</span>
<span id="cb22-9"><a href="advanced-data-manipulation-and-plotting.html#cb22-9" tabindex="-1"></a></span>
<span id="cb22-10"><a href="advanced-data-manipulation-and-plotting.html#cb22-10" tabindex="-1"></a><span class="co">#Cross join: </span></span>
<span id="cb22-11"><a href="advanced-data-manipulation-and-plotting.html#cb22-11" tabindex="-1"></a><span class="fu">merge</span>(<span class="at">x =</span> df1, <span class="at">y =</span> df2, <span class="at">by =</span> <span class="cn">NULL</span>)</span></code></pre></div>
<p> </p>
<p> </p>
<p> </p>
</div>
<div id="melting-vs-transposing" class="section level2 hasAnchor" number="4.5">
<h2><span class="header-section-number">4.5</span> Melting vs Transposing<a href="advanced-data-manipulation-and-plotting.html#melting-vs-transposing" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>I wrote in the previous chapter that the most important rule is that, in
a dataset, each row has to be an observation and each column has to
represent a variable. Now it is time to break this rule! In fact,
sometimes we need a different shape of dataset, usually when we want to
plot multidimensional data.</p>
<p>Melting data sounds strange, however this is what we want to do if we
have a wide dataset (a lot of variables) and we want to transform it in
a “long” dataset (only a few variables), but retaining all the
information.</p>
<p>Please remember: melting is not transposing! Transposing (<code>t()</code>
function) is useful when we have data in columns that we need to
rearrange in rows, while melting (<code>melt()</code>) creates a “long” dataset
with more variables in the same column. Note that the <code>melt()</code> function
belongs to the package <code>reshape2</code><span class="citation">(<a href="#ref-anderson2022">Anderson 2022</a>)</span>.</p>
<p>The code below generates a dataset, then transposes it, and melts it.
The <code>melt()</code> function requires us to specify the data we want to melt,
comma, the name of the variable(s) we want to retain as they are. We
will see in the following chapter how to use melted data.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="advanced-data-manipulation-and-plotting.html#cb23-1" tabindex="-1"></a><span class="co"># creating data</span></span>
<span id="cb23-2"><a href="advanced-data-manipulation-and-plotting.html#cb23-2" tabindex="-1"></a>people <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">name =</span> <span class="fu">c</span>(<span class="st">&quot;Mary&quot;</span>, <span class="st">&quot;Mike&quot;</span>, <span class="st">&quot;Greg&quot;</span>),</span>
<span id="cb23-3"><a href="advanced-data-manipulation-and-plotting.html#cb23-3" tabindex="-1"></a>                     <span class="at">surname =</span> <span class="fu">c</span>(<span class="st">&quot;Wilson&quot;</span>, <span class="st">&quot;Jones&quot;</span>, <span class="st">&quot;Smith&quot;</span>),</span>
<span id="cb23-4"><a href="advanced-data-manipulation-and-plotting.html#cb23-4" tabindex="-1"></a>                     <span class="at">age =</span> <span class="fu">c</span>(<span class="dv">44</span>, <span class="dv">52</span>, <span class="dv">46</span>),</span>
<span id="cb23-5"><a href="advanced-data-manipulation-and-plotting.html#cb23-5" tabindex="-1"></a>                     <span class="at">IQ =</span> <span class="fu">c</span>(<span class="dv">160</span>, <span class="dv">95</span>, <span class="dv">110</span>))</span>
<span id="cb23-6"><a href="advanced-data-manipulation-and-plotting.html#cb23-6" tabindex="-1"></a></span>
<span id="cb23-7"><a href="advanced-data-manipulation-and-plotting.html#cb23-7" tabindex="-1"></a><span class="co"># transpose</span></span>
<span id="cb23-8"><a href="advanced-data-manipulation-and-plotting.html#cb23-8" tabindex="-1"></a><span class="fu">t</span>(people)</span>
<span id="cb23-9"><a href="advanced-data-manipulation-and-plotting.html#cb23-9" tabindex="-1"></a></span>
<span id="cb23-10"><a href="advanced-data-manipulation-and-plotting.html#cb23-10" tabindex="-1"></a><span class="co"># melt</span></span>
<span id="cb23-11"><a href="advanced-data-manipulation-and-plotting.html#cb23-11" tabindex="-1"></a><span class="fu">library</span>(reshape2)</span>
<span id="cb23-12"><a href="advanced-data-manipulation-and-plotting.html#cb23-12" tabindex="-1"></a><span class="fu">melt</span>(people, <span class="at">id =</span> <span class="st">&quot;name&quot;</span>)</span>
<span id="cb23-13"><a href="advanced-data-manipulation-and-plotting.html#cb23-13" tabindex="-1"></a></span>
<span id="cb23-14"><a href="advanced-data-manipulation-and-plotting.html#cb23-14" tabindex="-1"></a><span class="co"># for two id variables</span></span>
<span id="cb23-15"><a href="advanced-data-manipulation-and-plotting.html#cb23-15" tabindex="-1"></a><span class="fu">melt</span>(people, <span class="at">id =</span> <span class="fu">c</span>(<span class="st">&quot;name&quot;</span>, <span class="st">&quot;surname&quot;</span>))</span></code></pre></div>
<p> </p>
<p> </p>
<p> </p>
</div>
<div id="ggplot2" class="section level2 hasAnchor" number="4.6">
<h2><span class="header-section-number">4.6</span> Ggplot2<a href="advanced-data-manipulation-and-plotting.html#ggplot2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><code>Ggplot2</code> is one of the most famous packages in R, and probably also one
of the most used. It allows us to draw almost all those beautiful graphs
for which R is known worldwide <span class="citation">(<a href="#ref-wickham2016">Wickham 2016</a>; <a href="#ref-chang2018">Chang 2018</a>)</span>. The main
advantage of <code>ggplot2</code> is its deep underlying grammar, which lets us
create a simple, expressive and descriptive code for plotting. Plots can
be built up iteratively, and edited in a second moment.</p>
<p>The <code>ggplot()</code> function tells R to generate the Cartesian axes where we
will place the graph, but this is yet not a graph yet. Within this line
we usually specify the dataset from which ggplot has to take the data,
and the variables corresponding to the Cartesian axes (using <code>aes()</code>).
After having specified the <code>ggplot()</code> function we can put a <code>+</code> sign
that will express our intention to put an additional layer on top of the
Cartesian space using the dedicated functions: <code>geom_point()</code> for a
scatter plot, <code>geom_smooth()</code> for a regression line, <code>geom_bar()</code> or
<code>geom_col()</code> for a bar chart, just to mention a few of them (for a
description of the meaning of the above mentioned graph refer to the
<a href="exploratory-data-analysis.html#data-visualization">Data visualization</a> chapter).</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="advanced-data-manipulation-and-plotting.html#cb24-1" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb24-2"><a href="advanced-data-manipulation-and-plotting.html#cb24-2" tabindex="-1"></a><span class="co"># No Plot Yet!</span></span>
<span id="cb24-3"><a href="advanced-data-manipulation-and-plotting.html#cb24-3" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>mtcars, <span class="fu">aes</span>(<span class="at">x=</span>mpg, <span class="at">y=</span>hp))</span>
<span id="cb24-4"><a href="advanced-data-manipulation-and-plotting.html#cb24-4" tabindex="-1"></a></span>
<span id="cb24-5"><a href="advanced-data-manipulation-and-plotting.html#cb24-5" tabindex="-1"></a><span class="co"># First scatterplot</span></span>
<span id="cb24-6"><a href="advanced-data-manipulation-and-plotting.html#cb24-6" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>mtcars, <span class="fu">aes</span>(<span class="at">x=</span>mpg, <span class="at">y=</span>hp)) <span class="sc">+</span> </span>
<span id="cb24-7"><a href="advanced-data-manipulation-and-plotting.html#cb24-7" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span>
<span id="cb24-8"><a href="advanced-data-manipulation-and-plotting.html#cb24-8" tabindex="-1"></a></span>
<span id="cb24-9"><a href="advanced-data-manipulation-and-plotting.html#cb24-9" tabindex="-1"></a><span class="co"># we can assign our graph to an object</span></span>
<span id="cb24-10"><a href="advanced-data-manipulation-and-plotting.html#cb24-10" tabindex="-1"></a>g <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>mtcars, <span class="fu">aes</span>(<span class="at">x=</span>mpg, <span class="at">y=</span>hp)) <span class="sc">+</span> </span>
<span id="cb24-11"><a href="advanced-data-manipulation-and-plotting.html#cb24-11" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code></pre></div>
<p>We can add more and more layers to the graph, and personalize all the
things we want. The code below generates two types of regression lines
(more details in [<a href="bivariate-analysis.html#linear-regression">Linear Regression</a>]), and divides data in plots
according to a variable (<code>facets_grid()</code>). <em>As you can see, I tend not
to assign my plot to an object, unless it is strictly necessary. This is
my way of working, but you are free to do as you prefer.</em></p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="advanced-data-manipulation-and-plotting.html#cb25-1" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb25-2"><a href="advanced-data-manipulation-and-plotting.html#cb25-2" tabindex="-1"></a><span class="co"># Adding More Layers: regression line</span></span>
<span id="cb25-3"><a href="advanced-data-manipulation-and-plotting.html#cb25-3" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>mtcars, <span class="fu">aes</span>(<span class="at">x=</span>mpg, <span class="at">y=</span>hp)) <span class="sc">+</span> </span>
<span id="cb25-4"><a href="advanced-data-manipulation-and-plotting.html#cb25-4" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb25-5"><a href="advanced-data-manipulation-and-plotting.html#cb25-5" tabindex="-1"></a>  <span class="fu">geom_smooth</span>() <span class="co"># Generalized additive models</span></span>
<span id="cb25-6"><a href="advanced-data-manipulation-and-plotting.html#cb25-6" tabindex="-1"></a></span>
<span id="cb25-7"><a href="advanced-data-manipulation-and-plotting.html#cb25-7" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>mtcars, <span class="fu">aes</span>(<span class="at">x=</span>mpg, <span class="at">y=</span>hp)) <span class="sc">+</span> </span>
<span id="cb25-8"><a href="advanced-data-manipulation-and-plotting.html#cb25-8" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb25-9"><a href="advanced-data-manipulation-and-plotting.html#cb25-9" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>) <span class="co">#linear regression</span></span>
<span id="cb25-10"><a href="advanced-data-manipulation-and-plotting.html#cb25-10" tabindex="-1"></a></span>
<span id="cb25-11"><a href="advanced-data-manipulation-and-plotting.html#cb25-11" tabindex="-1"></a><span class="co"># Adding More Layers: Facets</span></span>
<span id="cb25-12"><a href="advanced-data-manipulation-and-plotting.html#cb25-12" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>mtcars, <span class="fu">aes</span>(<span class="at">x=</span>mpg, <span class="at">y=</span>hp)) <span class="sc">+</span> </span>
<span id="cb25-13"><a href="advanced-data-manipulation-and-plotting.html#cb25-13" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb25-14"><a href="advanced-data-manipulation-and-plotting.html#cb25-14" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>) <span class="sc">+</span> </span>
<span id="cb25-15"><a href="advanced-data-manipulation-and-plotting.html#cb25-15" tabindex="-1"></a>  <span class="fu">facet_grid</span>(. <span class="sc">~</span> cyl)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-33"></span>
<img src="_main_files/figure-html/unnamed-chunk-33-1.png" alt="From top-left clockwise: Regression line GAM; Linear regression line; Facets." width="50%"  /><img src="_main_files/figure-html/unnamed-chunk-33-2.png" alt="From top-left clockwise: Regression line GAM; Linear regression line; Facets." width="50%"  /><img src="_main_files/figure-html/unnamed-chunk-33-3.png" alt="From top-left clockwise: Regression line GAM; Linear regression line; Facets." width="50%"  />
<p class="caption">
Figure 4.1: From top-left clockwise: Regression line GAM; Linear regression line; Facets.
</p>
</div>
<p>Following an example application of the need for melting data for the
scope of plotting multidimensional phenomenons. In this case, we have a
dataset with some students and we want to plot their scores, but we want
to be able to clearly see a trend for each one of them? A solution could
be the paired (specifying <code>position = 'dodge'</code>) bar chart below.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="advanced-data-manipulation-and-plotting.html#cb26-1" tabindex="-1"></a><span class="co"># creating data</span></span>
<span id="cb26-2"><a href="advanced-data-manipulation-and-plotting.html#cb26-2" tabindex="-1"></a>people <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">name =</span> <span class="fu">c</span>(<span class="st">&quot;Mary&quot;</span>, <span class="st">&quot;Mike&quot;</span>, <span class="st">&quot;Greg&quot;</span>),</span>
<span id="cb26-3"><a href="advanced-data-manipulation-and-plotting.html#cb26-3" tabindex="-1"></a>                     <span class="at">surname =</span> <span class="fu">c</span>(<span class="st">&quot;Wilson&quot;</span>, <span class="st">&quot;Jones&quot;</span>, <span class="st">&quot;Smith&quot;</span>),</span>
<span id="cb26-4"><a href="advanced-data-manipulation-and-plotting.html#cb26-4" tabindex="-1"></a>                     <span class="at">age =</span> <span class="fu">c</span>(<span class="dv">44</span>, <span class="dv">52</span>, <span class="dv">46</span>),</span>
<span id="cb26-5"><a href="advanced-data-manipulation-and-plotting.html#cb26-5" tabindex="-1"></a>                     <span class="at">IQ =</span> <span class="fu">c</span>(<span class="dv">160</span>, <span class="dv">95</span>, <span class="dv">110</span>))</span>
<span id="cb26-6"><a href="advanced-data-manipulation-and-plotting.html#cb26-6" tabindex="-1"></a></span>
<span id="cb26-7"><a href="advanced-data-manipulation-and-plotting.html#cb26-7" tabindex="-1"></a><span class="co"># melting data</span></span>
<span id="cb26-8"><a href="advanced-data-manipulation-and-plotting.html#cb26-8" tabindex="-1"></a><span class="fu">library</span>(reshape2)</span>
<span id="cb26-9"><a href="advanced-data-manipulation-and-plotting.html#cb26-9" tabindex="-1"></a>melted_people <span class="ot">&lt;-</span> <span class="fu">melt</span>(people, <span class="at">id =</span> <span class="fu">c</span>(<span class="st">&quot;name&quot;</span>, <span class="st">&quot;surname&quot;</span>))</span>
<span id="cb26-10"><a href="advanced-data-manipulation-and-plotting.html#cb26-10" tabindex="-1"></a></span>
<span id="cb26-11"><a href="advanced-data-manipulation-and-plotting.html#cb26-11" tabindex="-1"></a><span class="co"># plotting</span></span>
<span id="cb26-12"><a href="advanced-data-manipulation-and-plotting.html#cb26-12" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> melted_people, <span class="fu">aes</span>(<span class="at">x =</span> name, <span class="at">y =</span> value, <span class="at">fill =</span> variable)) <span class="sc">+</span></span>
<span id="cb26-13"><a href="advanced-data-manipulation-and-plotting.html#cb26-13" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="st">&#39;dodge&#39;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-34"></span>
<img src="_main_files/figure-html/unnamed-chunk-34-1.png" alt="Paired barchart." width="80%"  />
<p class="caption">
Figure 4.2: Paired barchart.
</p>
</div>
<p>We are able to personalize almost everything as we like using <code>ggplot2</code>.
The <a href="https://rstudio.com/wp-content/uploads/2015/03/ggplot2-cheatsheet.pdf">Ggplot2 Cheatsheet</a> gives us some of the most important options. I strongly suggest to look
also at the <a href="https://www.r-graph-gallery.com">R Graph Gallery</a> which
includes advanced graphs that are done using <code>ggplot2</code> or similar
packages, and provides the code for replicating each one of them.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="advanced-data-manipulation-and-plotting.html#cb27-1" tabindex="-1"></a><span class="co"># labeled points</span></span>
<span id="cb27-2"><a href="advanced-data-manipulation-and-plotting.html#cb27-2" tabindex="-1"></a><span class="fu">ggplot</span>(mtcars, <span class="fu">aes</span>(<span class="at">x =</span> hp, <span class="at">y =</span> mpg, <span class="at">size =</span> wt)) <span class="sc">+</span></span>
<span id="cb27-3"><a href="advanced-data-manipulation-and-plotting.html#cb27-3" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> <span class="fu">as.factor</span>(cyl)), <span class="at">alpha=</span>.<span class="dv">7</span>) <span class="sc">+</span></span>
<span id="cb27-4"><a href="advanced-data-manipulation-and-plotting.html#cb27-4" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">row.names</span>(mtcars)), <span class="at">size =</span> <span class="dv">3</span>, <span class="at">nudge_y =</span> <span class="sc">-</span>.<span class="dv">7</span>) <span class="sc">+</span></span>
<span id="cb27-5"><a href="advanced-data-manipulation-and-plotting.html#cb27-5" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_family =</span> <span class="st">&quot;Times&quot;</span>)</span>
<span id="cb27-6"><a href="advanced-data-manipulation-and-plotting.html#cb27-6" tabindex="-1"></a></span>
<span id="cb27-7"><a href="advanced-data-manipulation-and-plotting.html#cb27-7" tabindex="-1"></a><span class="co"># Violin plot</span></span>
<span id="cb27-8"><a href="advanced-data-manipulation-and-plotting.html#cb27-8" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;InsectSprays&quot;</span>)</span>
<span id="cb27-9"><a href="advanced-data-manipulation-and-plotting.html#cb27-9" tabindex="-1"></a><span class="fu">ggplot</span>(InsectSprays, <span class="fu">aes</span>(spray, count, <span class="at">fill=</span>spray)) <span class="sc">+</span></span>
<span id="cb27-10"><a href="advanced-data-manipulation-and-plotting.html#cb27-10" tabindex="-1"></a>  <span class="fu">geom_violin</span>(<span class="at">colour=</span><span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb27-11"><a href="advanced-data-manipulation-and-plotting.html#cb27-11" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Type of spray&quot;</span>) <span class="sc">+</span></span>
<span id="cb27-12"><a href="advanced-data-manipulation-and-plotting.html#cb27-12" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Insect count&quot;</span>) <span class="sc">+</span></span>
<span id="cb27-13"><a href="advanced-data-manipulation-and-plotting.html#cb27-13" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-35"></span>
<img src="_main_files/figure-html/unnamed-chunk-35-1.png" alt="From top-left clockwise: Labeled scatterplot; Violin plot." width="50%"  /><img src="_main_files/figure-html/unnamed-chunk-35-2.png" alt="From top-left clockwise: Labeled scatterplot; Violin plot." width="50%"  />
<p class="caption">
Figure 4.3: From top-left clockwise: Labeled scatterplot; Violin plot.
</p>
</div>
<p>Finally, I want to show you what to do if we have some outliers in our
data, but we need to plot the main trend excluding them. Below some
different versions of ggplot code that put a limit to the y axes (but it
could be done for the x axes too using <code>xlim()</code> instead of <code>ylim()</code>).
Try the code and see the difference.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="advanced-data-manipulation-and-plotting.html#cb28-1" tabindex="-1"></a><span class="co"># creating data</span></span>
<span id="cb28-2"><a href="advanced-data-manipulation-and-plotting.html#cb28-2" tabindex="-1"></a>testdat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>, </span>
<span id="cb28-3"><a href="advanced-data-manipulation-and-plotting.html#cb28-3" tabindex="-1"></a>                      <span class="at">y =</span> <span class="fu">rnorm</span>(<span class="dv">100</span>))</span>
<span id="cb28-4"><a href="advanced-data-manipulation-and-plotting.html#cb28-4" tabindex="-1"></a>testdat[<span class="dv">20</span>,<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="dv">100</span>  <span class="co"># Outlier!</span></span>
<span id="cb28-5"><a href="advanced-data-manipulation-and-plotting.html#cb28-5" tabindex="-1"></a></span>
<span id="cb28-6"><a href="advanced-data-manipulation-and-plotting.html#cb28-6" tabindex="-1"></a><span class="co"># normal plot</span></span>
<span id="cb28-7"><a href="advanced-data-manipulation-and-plotting.html#cb28-7" tabindex="-1"></a><span class="fu">ggplot</span>(testdat, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span> </span>
<span id="cb28-8"><a href="advanced-data-manipulation-and-plotting.html#cb28-8" tabindex="-1"></a>        <span class="fu">geom_line</span>()</span>
<span id="cb28-9"><a href="advanced-data-manipulation-and-plotting.html#cb28-9" tabindex="-1"></a></span>
<span id="cb28-10"><a href="advanced-data-manipulation-and-plotting.html#cb28-10" tabindex="-1"></a><span class="co"># excluding the values outside the ylim range</span></span>
<span id="cb28-11"><a href="advanced-data-manipulation-and-plotting.html#cb28-11" tabindex="-1"></a><span class="fu">ggplot</span>(testdat, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span> </span>
<span id="cb28-12"><a href="advanced-data-manipulation-and-plotting.html#cb28-12" tabindex="-1"></a>        <span class="fu">geom_line</span>() <span class="sc">+</span> </span>
<span id="cb28-13"><a href="advanced-data-manipulation-and-plotting.html#cb28-13" tabindex="-1"></a>        <span class="fu">ylim</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="dv">3</span>)</span>
<span id="cb28-14"><a href="advanced-data-manipulation-and-plotting.html#cb28-14" tabindex="-1"></a></span>
<span id="cb28-15"><a href="advanced-data-manipulation-and-plotting.html#cb28-15" tabindex="-1"></a><span class="co"># zooming in a portion of the graph</span></span>
<span id="cb28-16"><a href="advanced-data-manipulation-and-plotting.html#cb28-16" tabindex="-1"></a><span class="fu">ggplot</span>(testdat, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span> </span>
<span id="cb28-17"><a href="advanced-data-manipulation-and-plotting.html#cb28-17" tabindex="-1"></a>        <span class="fu">geom_line</span>() <span class="sc">+</span> </span>
<span id="cb28-18"><a href="advanced-data-manipulation-and-plotting.html#cb28-18" tabindex="-1"></a>        <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="dv">3</span>))</span></code></pre></div>
<p> </p>
<p> </p>
<p> </p>
</div>
<div id="exercises-1" class="section level2 hasAnchor" number="4.7">
<h2><span class="header-section-number">4.7</span> Exercises<a href="advanced-data-manipulation-and-plotting.html#exercises-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Exercises:</p>
<ul>
<li><a href="https://federicoroscioli.shinyapps.io/exercises/">R playground</a> -
Advanced Data Manipulation</li>
</ul>
<div style="page-break-after: always;"></div>
<p> </p>
<div style="page-break-after: always;"></div>
<p> </p>
<p> </p>
<p> </p>
<p> </p>

</div>
</div>



<p> </p>
</div>
<h3>Bibliography<a href="bibliography.html#bibliography" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-anderson2022" class="csl-entry">
Anderson, Sean C. 2022. <span>“An Introduction to Reshape2.”</span> <a href="https://seananderson.ca/2013/10/19/reshape/">https://seananderson.ca/2013/10/19/reshape/</a>.
</div>
<div id="ref-chang2018" class="csl-entry">
Chang, Winston. 2018. <em>R Graphics Cookbook: Practical Recipes for Visualizing Data</em>. Second edition. Beijing ; Boston: O’Reilly. <a href="https://r-graphics.org">https://r-graphics.org</a>.
</div>
<div id="ref-kaplan2022" class="csl-entry">
Kaplan, Jacob. 2022. <span>“fastDummies.”</span> <a href="https://jacobkap.github.io/fastDummies/">https://jacobkap.github.io/fastDummies/</a>.
</div>
<div id="ref-sovanskywinter2022" class="csl-entry">
Sovansky Winter, Erin. 2022. <span>“Chapter 4: Apply Functions.”</span> In. <a href="https://ademos.people.uic.edu/Chapter4.html">https://ademos.people.uic.edu/Chapter4.html</a>.
</div>
<div id="ref-wickham2016" class="csl-entry">
———. 2016. <em>Ggplot2: Elegant Graphics for Data Analysis</em>. Springer-Verlag New York. <a href="https://ggplot2.tidyverse.org/reference/">https://ggplot2.tidyverse.org/reference/</a>.
</div>
<div id="ref-wickham2022" class="csl-entry">
Wickham, Hadley, and Jennifer Bryan. 2022. <span>“Readxl: Read Excel Files.”</span> <a href="https://readxl.tidyverse.org">https://readxl.tidyverse.org</a>.
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="data-cleaning.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="exploratory-data-analysis.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="book_assets/gitbook-2.6.7/js/app.min.js"></script>
<script src="book_assets/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="book_assets/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="book_assets/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="book_assets/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="book_assets/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="book_assets/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="book_assets/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section",
"toc_depth": 1,
"scroll_highlight": true
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
